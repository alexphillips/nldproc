<canvas id='drawTarget' width='500' height='500'></canvas>

<script>

var curve = {};

curve.xs = [-1.0,1.0];
curve.ys = [-1.0,1.0];
curve.ks = [0.0,0.0];


function getCursorPosition(canvas, event) {
    var rect = canvas.getBoundingClientRect();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    return [x,y];
}

var evalSpline = function(x, xs, ys, ks)
{
    var i = 1;
    while(xs[i]<x) i++;
		
    var t = (x - xs[i-1]) / (xs[i] - xs[i-1]);
		
    var a =  ks[i-1]*(xs[i]-xs[i-1]) - (ys[i]-ys[i-1]);
    var b = -ks[i  ]*(xs[i]-xs[i-1]) + (ys[i]-ys[i-1]);
		
    var q = (1-t)*ys[i-1] + t*ys[i] + t*(1-t)*(a*(1-t)+b*t);
    return q;
}


var drawSpline = function() {


    var c = document.getElementById("drawTarget");
    var ctx = c.getContext("2d");

    ctx.lineWidth = 3;
    ctx.fillStyle="white";
    ctx.clearRect(0,0,500,500);

    for(var x =0; x<499; ++x) {
        var normalX = (x/250)-1;
        var y = (evalSpline(normalX,curve.xs,curve.ys,curve.ks)*-250)+250;

        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x+1,y);
        ctx.stroke();
        ctx.closePath();
    }
}



//drawSpline( curve.xs,curve.ys,curve.ks);

var addPoint = function(event) {

    var c = document.getElementById("drawTarget");
    var xy = getCursorPosition(c,event);
    var x = (xy[0]/250)-1;
    var y = ((xy[1]/250)*-1)+1;


    for(var idx =0; idx<curve.xs.length;++idx) {
        if(curve.xs[idx]>x) {
            curve.xs.splice(idx,0,x);
            curve.ys.splice(idx,0,y);

            var k = Number(prompt("k value?"));

            curve.ks.splice(idx,0,0.0);
            break;
        }
    }

    console.log(x,y);
    console.log(curve);
    setTimeout( drawSpline,15);
}

document.getElementById('drawTarget').addEventListener('click', addPoint );

drawSpline();
</script>

